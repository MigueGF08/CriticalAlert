<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CritAlert - Entrada Completa</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 2rem; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h2 { color: #d32f2f; text-align: center; margin-bottom: 1.5rem; }
        .section-heading { background: #fbecec; color: #d32f2f; padding: 8px; margin-top: 15px; margin-bottom: 10px; border-radius: 5px; font-weight: bold; }
        .form-group { margin-bottom: 1rem; display: flex; flex-wrap: wrap; gap: 20px; }
        .input-half { flex: 1; min-width: 250px; }
        label { display: block; margin-bottom: 0.5rem; color: #555; }
        input, select { width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { width: 100%; padding: 0.75rem; margin-top: 20px; background: #d32f2f; color: white; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; transition: background 0.3s; }
        button:hover { background: #b71c1c; }
        #status { margin-top: 1rem; text-align: center; font-weight: bold; }
        .normal { color: green; }
        .critical { color: red; }
    </style>
</head>
<body>
    <div class="container">
        <h2>üö® CritAlert: Simulador de Resultado Cr√≠tico</h2>

        <div class="section-heading">Datos del Paciente</div>
        <div class="form-group">
            <div class="input-half">
                <label>ID Resultado</label>
                <input type="text" id="result_id" value="RES-CRIT-001" readonly>
            </div>
            <div class="input-half">
                <label>Nombre del Paciente</label>
                <input type="text" id="patient_name" value="John Smith">
            </div>
            <div class="input-half">
                <label>Edad (patient_age)</label>
                <input type="number" id="patient_age" value="67">
            </div>
            <div class="input-half">
                <label>ID Paciente (patient_id)</label>
                <input type="text" id="patient_id" value="P123456">
            </div>
        </div>
        
        <div class="section-heading">Resultado del Test</div>
        <div class="form-group">
            <div class="input-half">
                <label>Test (test_name)</label>
                <select id="test_name">
                    <option value="Potassium">Potasio (K)</option>
                    <option value="Glucose">Glucosa</option>
                </select>
            </div>
            <div class="input-half">
                <label>C√≥digo Test (test_code)</label>
                <input type="text" id="test_code" value="K">
            </div>
            <div class="input-half">
                <label>Valor Resultado</label>
                <input type="number" step="0.1" id="value" value="6.8">
            </div>
            <div class="input-half">
                <label>Rango Referencia (reference_range)</label>
                <input type="text" id="reference_range" value="3.5-5.0">
            </div>
        </div>

        <div class="section-heading">Detalles de Criticidad</div>
        <div class="form-group">
            <div class="input-half">
                <label>Nivel (criticality.level)</label>
                <input type="text" id="criticality_level" value="SEVERE">
            </div>
            <div class="input-half">
                <label>Raz√≥n (criticality.reason)</label>
                <input type="text" id="criticality_reason" value="Critically high potassium - cardiac arrhythmia risk">
            </div>
            <div class="input-half">
                <label>Acci√≥n Requerida (action_required)</label>
                <input type="text" id="action_required" value="Immediate physician notification and ECG monitoring">
            </div>
        </div>

        <div class="section-heading">M√©dicos (Para Notificaci√≥n)</div>
        <div class="form-group">
            <div class="input-half">
                <label>Dr. Principal (name)</label>
                <input type="text" id="dr_name" value="Dr. Sarah Johnson">
            </div>
            <div class="input-half">
                <label>Dr. Principal Tel√©fono (phone)</label>
                <input type="text" id="dr_phone" value="+1-555-0101">
            </div>
            <div class="input-half">
                <label>Dr. Backup (name)</label>
                <input type="text" id="backup_name" value="Dr. Michael Chen">
            </div>
            <div class="input-half">
                <label>Dr. Backup Tel√©fono (phone)</label>
                <input type="text" id="backup_phone" value="+1-555-0201">
            </div>
        </div>

        <button onclick="sendData()">Enviar Resultado Cr√≠tico a AWS</button>
        <div id="status"></div>
    </div>

    <script>
        function getTimestamp() {
            return new Date().toISOString().replace(/\.\d{3}Z$/, 'Z');
        }

        async function sendData() {
            const btn = document.querySelector('button');
            const statusDiv = document.getElementById('status');
            
            btn.disabled = true;
            btn.innerText = "Procesando...";
            statusDiv.innerHTML = "";

            const data = {
                "result_id": document.getElementById('result_id').value,
                "patient_id": document.getElementById('patient_id').value,
                "patient_name": document.getElementById('patient_name').value,
                "patient_age": parseInt(document.getElementById('patient_age').value),
                "test_code": document.getElementById('test_code').value,
                "test_name": document.getElementById('test_name').value,
                "value": parseFloat(document.getElementById('value').value),
                "unit": "mmol/L",
                "reference_range": document.getElementById('reference_range').value,
                "is_critical": true,
                "criticality": {
                    "level": document.getElementById('criticality_level').value,
                    "reason": document.getElementById('criticality_reason').value,
                    "action_required": document.getElementById('action_required').value
                },
                "ordering_physician": {
                    "physician_id": "DR001",
                    "name": document.getElementById('dr_name').value,
                    "phone": document.getElementById('dr_phone').value,
                    "email": "s.johnson@hospital.com"
                },
                "backup_physician": {
                    "physician_id": "DR002",
                    "name": document.getElementById('backup_name').value,
                    "phone": document.getElementById('backup_phone').value
                },
                "test_timestamp": getTimestamp(),
                "alert_timestamp": getTimestamp(),
                "time_to_alert_seconds": 0 
            };
            
            try {
                const configResponse = await fetch('config.json');
                const config = await configResponse.json();
                
                const response = await fetch(config.api_url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if(response.ok) {
                    statusDiv.innerHTML = "<span class='critical'>‚ö†Ô∏è ALERTA ENVIADA. Step Function iniciada.</span>";
                } else {
                    statusDiv.innerHTML = "<span class='normal'>‚ö†Ô∏è ERROR AL ENVIAR: " + result.error + "</span>";
                }
            } catch (e) {
                statusDiv.innerText = "Error de conexi√≥n/CORS. Aseg√∫rate de que el API Gateway est√© activo: " + e.message;
            } finally {
                btn.disabled = false;
                btn.innerText = "Enviar Resultado Cr√≠tico a AWS";
            }
        }
    </script>
</body>
</html>